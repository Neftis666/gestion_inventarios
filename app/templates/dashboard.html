{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h2>ğŸ“Š Panel Principal</h2>
  <p class="text-muted">
    Bienvenido, <strong>{{ session.get('full_name', session.get('username')) }}</strong> 
    | Rol: <span class="badge bg-{{ 'primary' if session.get('role_name') == 'ADMINISTRADOR' else 'info' if session.get('role_name') == 'ASTRID' else 'success' if session.get('role_name') == 'JUAN_ANDRES' else 'secondary' }}">{{ session.get('role_display', 'Usuario') }}</span>
  </p>

  <!-- ============================================================ -->
  <!-- VISTA ESPECÃFICA PARA COMERCIAL -->
  <!-- ============================================================ -->
  {% if session.get('role_name') == 'COMERCIAL' %}
  
  <div class="alert alert-info mt-3">
    <i class="bi bi-info-circle"></i> Tu rol te permite <strong>crear Ã³rdenes de compra</strong> y <strong>consultar el inventario</strong>.
  </div>

  <div class="row mt-4">
    <!-- Tarjeta principal: Crear Orden -->
    <div class="col-md-6 mb-4">
      <div class="card shadow border-primary h-100">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0"><i class="bi bi-file-earmark-plus"></i> Crear Orden de Compra</h4>
        </div>
        <div class="card-body text-center d-flex flex-column justify-content-center">
          <p class="text-muted mb-4">Genera una nueva solicitud de orden de compra para que sea aprobada.</p>
          <a href="{{ url_for('ordenes.nueva_orden') }}" class="btn btn-primary btn-lg">
            <i class="bi bi-plus-circle"></i> Nueva Orden de Compra
          </a>
        </div>
      </div>
    </div>
    
    <!-- Tarjeta: Ver mis Ã³rdenes -->
    <div class="col-md-6 mb-4">
      <div class="card shadow border-info h-100">
        <div class="card-header bg-info text-white">
          <h4 class="mb-0"><i class="bi bi-list-check"></i> Mis Ã“rdenes</h4>
        </div>
        <div class="card-body text-center d-flex flex-column justify-content-center">
          <p class="text-muted mb-4">Revisa el estado de tus Ã³rdenes de compra.</p>
          <a href="{{ url_for('ordenes.listar_ordenes') }}" class="btn btn-info btn-lg text-white">
            <i class="bi bi-eye"></i> Ver Mis Ã“rdenes
          </a>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <!-- Tarjeta: Consultar Inventario -->
    <div class="col-md-12 mb-4">
      <div class="card shadow border-secondary">
        <div class="card-header bg-secondary text-white">
          <h4 class="mb-0"><i class="bi bi-box-seam"></i> Consultar Inventario</h4>
        </div>
        <div class="card-body">
          <div class="row align-items-center">
            <div class="col-md-8">
              <p class="text-muted mb-0">Consulta los productos disponibles en el inventario para incluirlos en tus Ã³rdenes.</p>
            </div>
            <div class="col-md-4 text-end">
              <a href="{{ url_for('inventario.listar_inventario') }}" class="btn btn-secondary">
                <i class="bi bi-search"></i> Ver Inventario
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Resumen para Comercial -->
  <div class="row">
    <div class="col-md-6">
      <div class="card shadow-sm text-center p-4">
        <h5 class="text-muted">ğŸ“¦ Productos en Inventario</h5>
        <h1 class="text-warning">{{ total_productos }}</h1>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card shadow-sm text-center p-4">
        <h5 class="text-muted">ğŸ“‹ Ã“rdenes Pendientes</h5>
        <h1 class="text-info">{{ ordenes_pendientes }}</h1>
      </div>
    </div>
  </div>

  <!-- ============================================================ -->
  <!-- VISTA PARA JUAN_ANDRES -->
  <!-- ============================================================ -->
  {% elif session.get('role_name') == 'JUAN_ANDRES' %}
  
  <!-- Tarjetas de resumen -->
  <div class="row text-center mt-4">
    <div class="col-md-4">
      <div class="card shadow-sm p-3 border-warning">
        <h4>ğŸ“¦ Productos</h4>
        <h2 class="text-warning">{{ total_productos }}</h2>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card shadow-sm p-3 border-danger">
        <h4>âš ï¸ Stock CrÃ­tico</h4>
        <h2 class="text-danger">{{ stock_critico }}</h2>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card shadow-sm p-3 border-info">
        <h4>ğŸ“‹ Ã“rdenes Pendientes</h4>
        <h2 class="text-info">{{ ordenes_pendientes }}</h2>
      </div>
    </div>
  </div>

  <div class="row mt-4">
    <!-- Alertas -->
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-header bg-danger text-white">
          <h5 class="mb-0">âš ï¸ Alertas de Inventario</h5>
        </div>
        <div class="card-body">
          <ul class="list-group list-group-flush">
            {% if stock_critico > 0 %}
            <li class="list-group-item list-group-item-danger">
              <strong>{{ stock_critico }}</strong> productos con stock crÃ­tico
              <a href="{{ url_for('inventario.listar_inventario') }}" class="float-end btn btn-sm btn-danger">Ver</a>
            </li>
            {% endif %}
            {% if stock_bajo > 0 %}
            <li class="list-group-item list-group-item-warning">
              <strong>{{ stock_bajo }}</strong> productos con stock bajo
            </li>
            {% endif %}
            {% if stock_critico == 0 and stock_bajo == 0 %}
            <li class="list-group-item list-group-item-success">
              âœ… Inventario en buen estado
            </li>
            {% endif %}
          </ul>
        </div>
      </div>
    </div>
    
    <!-- Accesos rÃ¡pidos -->
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">ğŸš€ Accesos RÃ¡pidos</h5>
        </div>
        <div class="card-body">
          <div class="d-grid gap-2">
            <a href="{{ url_for('inventario.nuevo_producto') }}" class="btn btn-warning">ğŸ“¦ Nuevo Producto</a>
            <a href="{{ url_for('inventario.listar_inventario') }}" class="btn btn-outline-warning">ğŸ“‹ Ver Inventario</a>
            <a href="{{ url_for('barcode.index') }}" class="btn btn-outline-secondary">ğŸ·ï¸ CÃ³digos de Barras</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ============================================================ -->
  <!-- VISTA PARA ADMINISTRADOR Y ASTRID (completa) -->
  <!-- ============================================================ -->
  {% else %}
  
  <!-- Tarjetas de resumen completas -->
  <div class="row text-center mt-4">
    {% if session.get('permissions', {}).get('can_manage_users') %}
    <div class="col-md-3">
      <div class="card shadow-sm p-3 border-primary">
        <h4>ğŸ‘¤ Usuarios</h4>
        <h2 class="text-primary">{{ total_users }}</h2>
      </div>
    </div>
    {% endif %}
    
    <div class="col-md-3">
      <div class="card shadow-sm p-3 border-info">
        <h4>ğŸ§¾ Compras</h4>
        <h2 class="text-info">{{ total_compras }}</h2>
      </div>
    </div>
    
    <div class="col-md-3">
      <div class="card shadow-sm p-3 border-success">
        <h4>ğŸ’² Ventas</h4>
        <h2 class="text-success">{{ total_ventas }}</h2>
      </div>
    </div>
    
    <div class="col-md-3">
      <div class="card shadow-sm p-3 border-warning">
        <h4>ğŸ“¦ Productos</h4>
        <h2 class="text-warning">{{ total_productos }}</h2>
      </div>
    </div>
  </div>

  <!-- Segunda fila de mÃ©tricas -->
  <div class="row text-center mt-3">
    <div class="col-md-4">
      <div class="card shadow-sm p-3 border-danger">
        <h5>âš ï¸ Stock CrÃ­tico</h5>
        <h3 class="text-danger">{{ stock_critico }}</h3>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card shadow-sm p-3 border-warning">
        <h5>ğŸ“‰ Stock Bajo</h5>
        <h3 class="text-warning">{{ stock_bajo }}</h3>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card shadow-sm p-3 border-info">
        <h5>ğŸ“‹ Ã“rdenes Pendientes</h5>
        <h3 class="text-info">{{ ordenes_pendientes }}</h3>
      </div>
    </div>
  </div>

  <div class="row mt-4">
    <!-- Alertas -->
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-header bg-danger text-white">
          <h5 class="mb-0">âš ï¸ Alertas</h5>
        </div>
        <div class="card-body">
          <ul class="list-group list-group-flush">
            {% if stock_critico > 0 %}
            <li class="list-group-item list-group-item-danger">
              <strong>{{ stock_critico }}</strong> productos con stock crÃ­tico
              <a href="{{ url_for('inventario.listar_inventario') }}" class="float-end btn btn-sm btn-danger">Ver</a>
            </li>
            {% endif %}
            {% if ordenes_pendientes > 0 %}
            <li class="list-group-item list-group-item-warning">
              <strong>{{ ordenes_pendientes }}</strong> Ã³rdenes pendientes de aprobar
              <a href="{{ url_for('ordenes.listar_ordenes') }}" class="float-end btn btn-sm btn-warning">Ver</a>
            </li>
            {% endif %}
            {% if stock_critico == 0 and ordenes_pendientes == 0 %}
            <li class="list-group-item list-group-item-success">
              âœ… No hay alertas pendientes
            </li>
            {% endif %}
          </ul>
        </div>
      </div>
    </div>
    
    <!-- Accesos rÃ¡pidos -->
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">ğŸš€ Accesos RÃ¡pidos</h5>
        </div>
        <div class="card-body">
          <div class="d-grid gap-2">
            <a href="{{ url_for('compras.nueva_compra') }}" class="btn btn-primary">ğŸ§¾ Nueva Compra</a>
            <a href="{{ url_for('ventas.nueva_venta') }}" class="btn btn-success">ğŸ’² Nueva Venta</a>
            <a href="{{ url_for('inventario.nuevo_producto') }}" class="btn btn-warning">ğŸ“¦ Nuevo Producto</a>
            <a href="{{ url_for('ordenes.nueva_orden') }}" class="btn btn-info">ğŸ“‘ Nueva Orden</a>
            {% if session.get('permissions', {}).get('can_manage_users') %}
            <a href="{{ url_for('usuarios.listar_usuarios') }}" class="btn btn-outline-primary">ğŸ‘¤ Gestionar Usuarios</a>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
  
  {% endif %}
</div>
{% endblock %}
